<?xml version='1.0' encoding='utf-8' standalone='no'?>
<!DOCTYPE issue SYSTEM "lwg-issue.dtd">

<issue num="2754" status="New">
<title>The <tt>in_place</tt> constructors and <tt>emplace</tt> functions added by P0032R3 don't require <tt>CopyConstructible</tt></title>
<section><sref ref="[any.cons]"/><sref ref="[any.modifiers]"/></section>
<submitter>Ville Voutilainen</submitter>
<date>5 Jul 2016</date>
<priority>1</priority>

<discussion>
<p>
The <tt>in_place</tt> constructors and <tt>emplace</tt> functions
added by <a href="http://wg21.link/p0032r3">P0032R3</a> don't require <tt>CopyConstructible</tt>.
<p/>
They must. Otherwise copying an <tt>any</tt> that's made to hold a non-<tt>CopyConstructible</tt>
type must fail with a run-time error. Since that's crazy, we want to prevent
storing non-<tt>CopyConstructible</tt> types in an <tt>any</tt>.
<p/>
Previously, the requirement for <tt>CopyConstructible</tt> was just on the converting
constructor template and the converting assignment operator template on <tt>any</tt>.
Now that we are adding two <tt>in_place</tt> constructor overloads and two
<tt>emplace</tt> overloads, it seems reasonable to require <tt>CopyConstructible</tt> in some more 
general location, in order to avoid repeating that requirement all over the place.
</p>
<note>07-16 - Chicago</note>
<p>Monday: P1</p>
<p>Tuesday: Ville/Billy/Billy provide wording</p>
</discussion>

<resolution>
<note>Drafting note: this p/r doesn't turn the Requires-clauses into Remarks-clauses.
We might want to do that separately, because SFINAEing the constructors
allows users to query for is_constructible and get the right answer. Failing
to mandate the SFINAE will lead to non-portable answers for is_constructible.
Currently, libstdc++ SFINAEs. That should be done as a separate issue,
as this issue is an urgent bug-fix but the mandated SFINAE is not.</note>

<blockquote>
<p>In [any.cons]/11, edit the Requires-clause as follows:</p>

<p><I>Requires:</I> <ins><tt>T</tt> shall satisfy the CopyConstructible requirements and</ins>
<tt>is_constructible_v&lt;T, Args...&gt;</tt> is true.</p>

<p>In [any.cons]/15, edit the Requires-clause as follows:</p>

<p><I>Requires:</I> <ins><tt>T</tt> shall satisfy the CopyConstructible requirements and</ins>
<tt>is_constructible_v&lt;T, initializer_list&lt;U&gt;&, Args...&gt;</tt> is true.</p>

<p>In [any.modifiers]/1, edit the Requires-clause as follows:</p>

<p><I>Requires:</I> <ins><tt>T</tt> shall satisfy the CopyConstructible requirements and</ins>
<tt>is_constructible_v&lt;T, Args...&gt;</tt> is true.</p>

<p>Before [any.modifiers]/6, add a Requires-clause:</p>

<p><ins><I>Requires</I>: <tt>T</tt> shall satisfy the CopyConstructible requirements and
<tt>is_constructible_v&lt;T, initializer_list&lt;U&gt;, Args...&gt;</tt> is true.</ins></p>
</blockquote>
</resolution>

</issue>
