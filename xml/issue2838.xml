<?xml version='1.0' encoding='utf-8' standalone='no'?>
<!DOCTYPE issue SYSTEM "lwg-issue.dtd">

<issue num="2838" status="New">
<title><tt>directory_iterator::increment</tt> is narrow-contract but marked <tt>noexcept</tt></title>
<section><sref ref="[directory_iterator.members]"/><sref ref="[rec.dir.itr.members]"/></section>
<submitter>Tim Song</submitter>
<date>9 Dec 2016</date>
<priority>99</priority>

<discussion>
<p>
<tt>directory_iterator::increment</tt> and <tt>recursive_directory_iterator::increment</tt> are specified by 
reference to the input iterator requirements, which is narrow-contract: it's undefined behavior to increment 
a nondeferenceable iterator. Yet they are marked as <tt>noexcept</tt>.
</p>
</discussion>

<resolution>
<p>This wording is relative to <a href="http://wg21.link/n4618">N4618</a>.</p>

<ol>
<li><p>Edit <sref ref="[class.directory_iterator]"/>, class <tt>directory_iterator</tt> synopsis, as indicated:</p>
<blockquote>
<pre>
directory_iterator&amp; operator++();
directory_iterator&amp; increment(error_code&amp; ec) <del>noexcept</del>;
</pre>
</blockquote>
</li>

<li><p>Edit <sref ref="[directory_iterator.members]"/> as indicated:</p>
<blockquote>
<pre>
directory_iterator&amp; operator++();
directory_iterator&amp; increment(error_code&amp; ec) <del>noexcept</del>;
</pre>
<blockquote>
<p>
-10- <i>Effects:</i> As specified for the prefix increment operation of Input iterators (<sref ref="[input.iterators]"/>).
<p/>
-11- <i>Returns:</i> <tt>*this</tt>.
<p/>
-12- <i>Throws:</i> As specified in <sref ref="[fs.err.report]"/>.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Edit <sref ref="[class.rec.dir.itr]"/>, class <tt>recursive_directory_iterator</tt> synopsis, as indicated:</p>
<blockquote>
<pre>
recursive_directory_iterator&amp; operator++();
recursive_directory_iterator&amp; increment(error_code&amp; ec) <del>noexcept</del>;
</pre>
</blockquote>
</li>

<li><p>Edit <sref ref="[rec.dir.itr.members]"/> as indicated:</p>
<blockquote>
<pre>
recursive_directory_iterator&amp; operator++();
recursive_directory_iterator&amp; increment(error_code&amp; ec) <del>noexcept</del>;
</pre>
<blockquote>
<p>
-23- <i>Effects:</i> As specified for the prefix increment operation of Input iterators (<sref ref="[input.iterators]"/>), 
except that: [&hellip;]
<p/>
-24- <i>Returns:</i> <tt>*this</tt>.
<p/>
-25- <i>Throws:</i> As specified in <sref ref="[fs.err.report]"/>.
</p>
</blockquote>
</blockquote>
</li>
</ol>

</resolution>

</issue>
