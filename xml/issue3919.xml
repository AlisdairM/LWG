<?xml version='1.0' encoding='utf-8' standalone='no'?>
<!DOCTYPE issue SYSTEM "lwg-issue.dtd">

<issue num="3919" status="New">
<title><tt>enumerate_view</tt> may invoke UB for sized common non-forward underlying ranges</title>
<section><sref ref="[range.enumerate]"/></section>
<submitter>Patrick Palka</submitter>
<date>7 Apr 2023</date>
<priority>99</priority>

<discussion>
<p>
For a sized common range, <tt>enumerate_view::end()</tt> is specified to call
<tt>ranges::distance</tt>. But <tt>ranges::distance</tt> is not necessarily well-defined
for a sized non-forward range after calling <tt>ranges::begin</tt> (according to
<sref ref="[range.sized]"/>).
<p/>
So for a sized common non-forward underlying range, it seems calling
<tt>enumerate_view::begin()</tt> followed by <tt>enumerate_view::end()</tt> may invoke UB
and thus make <tt>enumerate_view</tt> potentially unusable for such ranges.
<p/>
I suppose we might need to instead call and cache the result of
<tt>ranges::distance</tt> from <tt>enumerate_view::begin()</tt> for such ranges.
</p>
</discussion>

<resolution>
</resolution>

</issue>
