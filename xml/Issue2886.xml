<?xml version='1.0' encoding='utf-8' standalone='no'?>
<!DOCTYPE issue SYSTEM "lwg-issue.dtd">

<issue num="2886" status="New">
<title>Keep the <tt>empty()</tt> functions in <tt>variant</tt></title>
<section><sref ref="[section.ref.here]"/></section>
<submitter>Finland</submitter>
<date>3 Feb 2017</date>
<priority>99</priority>

<discussion>
<b>Addresses FI 7</b>

<p>The proposal p0032 has multiple problems: 1) it turns member function .empty() into .has_value(), negating the logic. Refactoring e.g. existing uses of std::experimental::any to use std::any thus involve non-trivial refactorings that are error- prone and can’t be done via simple search-and- replace if there are containers in the same source files for which .empty() is used (based on the implementation experience of making the change in libstdc++ and refactoring the testsuite). Whilst any is not a container, the library is failing to go towards a direction where there would be a generic way to query for emptiness. 2) The use of function references for tag types makes the interface hard to use. The tag types do not have value semantics like every other tag type has, the tag types are hard to construct, and present surprises for certain kinds of overload sets. Furthermore, any attempts to decay the tag types produces a really surprising effect – as opposed to what the other tag types do, which is that the result of decaying them is the tag type itself, decaying these new tag types results in a pointer to function.</p>

<p>Proposed change: Keep the .empty() functions (and introduce them to all the types that are supposed to have a omogeneous interface), and make the tag types be regular tag types that are not references to functions.</p>

<note>Marshall notes (3-Feb-2017)</note>
<p>P0504R0 (adopted in Issaquah) removed use of function references for tag types</p>
</discussion>

<resolution>
<p>
</p>
</resolution>

</issue>

